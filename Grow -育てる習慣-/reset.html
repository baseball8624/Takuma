<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cache Reset Tool</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            text-align: center;
        }

        .success {
            color: green;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>ğŸ› ï¸ ã‚¢ãƒ—ãƒªä¿®å¾©ãƒ„ãƒ¼ãƒ«</h1>
    <p>å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™...</p>
    <div id="log"></div>

    <script>
        const log = (msg) => {
            const el = document.getElementById('log');
            el.innerHTML += `<div>${msg}</div>`;
            console.log(msg);
        };

        async function cleanup() {
            try {
                // 1. Unregister Service Workers
                if ('serviceWorker' in navigator) {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    if (registrations.length === 0) {
                        log('Service Worker: æœªç™»éŒ²ã§ã™ (OK)');
                    } else {
                        for (const registration of registrations) {
                            await registration.unregister();
                            log(`Service Worker å‰Šé™¤å®Œäº†: ${registration.scope}`);
                        }
                    }
                }

                // 2. Clear Cache Storage
                if ('caches' in window) {
                    const keys = await caches.keys();
                    if (keys.length === 0) {
                        log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥: ç©ºã§ã™ (OK)');
                    } else {
                        for (const key of keys) {
                            await caches.delete(key);
                            log(`ã‚­ãƒ£ãƒƒã‚·ãƒ¥å‰Šé™¤å®Œäº†: ${key}`);
                        }
                    }
                }

                log('<br><span class="success">âœ¨ å®Œäº†ã—ã¾ã—ãŸï¼ã“ã®ã‚¿ãƒ–ã‚’é–‰ã˜ã¦ã€ã‚¢ãƒ—ãƒªã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</span>');

            } catch (e) {
                log(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${e.message}`);
            }
        }

        cleanup();
    </script>
</body>

</html>